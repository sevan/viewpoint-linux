Phase #4, chapter 8 of LFS 10.1 guide

glibc
configure --prefix=/usr --disable-werror --enable-kernel=3.2 --enable-stack-protector=strong --with-headers=/usr/include --disable-nscd CFLAGS="-fno-omit-frame-pointer -g -O2"

zlib
configure --prefix=/usr --libdir=/usr/lib64

zstd
make
make check
make prefix=/usr libdir=/usr/lib64 install

file
configure --prefix=/usr --libdir=/usr/lib64

readline
configure --prefix=/usr --disable-static --with-curses --libdir=/usr/lib64
make SHLIB_LIBS="-lncursesw"
make SHLIB_LIBS="-lncursesw" install

bc
CC=gcc PREFIX=/usr LIBDIR=/usr/lib64 ./configure.sh -G -O3 -T

flex
configure --prefix=/osbt --disable-static

tcl
SRCDIR=$(pwd)
configure --prefix=/osbt --mandir=/osbt/share/man --enable-64bit
make
sed -e "s|$SRCDIR/unix|/osbt/lib|" \
    -e "s|$SRCDIR|/osbt/include|"  \
    -i tclConfig.sh

sed -e "s|$SRCDIR/unix/pkgs/tdbc1.1.2|/osbt/lib/tdbc1.1.2|" \
    -e "s|$SRCDIR/pkgs/tdbc1.1.2/generic|/osbt/include|"    \
    -e "s|$SRCDIR/pkgs/tdbc1.1.2/library|/osbt/lib/tcl8.6|" \
    -e "s|$SRCDIR/pkgs/tdbc1.1.2|/osbt/include|"            \
    -i pkgs/tdbc1.1.2/tdbcConfig.sh

sed -e "s|$SRCDIR/unix/pkgs/itcl4.2.1|/osbt/lib/itcl4.2.1|" \
    -e "s|$SRCDIR/pkgs/itcl4.2.1/generic|/osbt/include|"    \
    -e "s|$SRCDIR/pkgs/itcl4.2.1|/osbt/include|"            \
    -i pkgs/itcl4.2.1/itclConfig.sh
unset SRCDIR
make test
make install
make install-private-headers
ln -s tclsh8.6 /osbt/bin/tclsh
mv /osbt/share/man/man3/{Thread,Tcl_Thread}.3

expect
configure --prefix=/osbt --with-tcl=/osbt/lib --enable-shared --with-tclinclude=/osbt/include
make
make test
make install
ln -s expect5.45.4/libexpect5.45.4.so /osbt/lib

dejagnu
configure --prefix=/osbt
make
make install
make check

binutils
configure --prefix=/usr --enable-gold --enable-ld=default --enable-plugins  --enable-shared --disable-werror  --enable-64-bit-bfd  --with-system-zlib --libdir=/usr/lib64

gmp
configure --prefix=/usr --enable-cxx --disable-static --libdir=/usr/lib64

mpfr
configure --prefix=/usr --disable-static --enable-thread-safe --libdir=/usr/lib64

mpc
configure --prefix=/usr --disable-static --libdir=/usr/lib64

attr
configure --prefix=/usr --disable-static --sysconfdir=/etc --libdir=/usr/lib64

acl
configure --prefix=/usr --disable-static --libdir=/usr/lib64

libcap
make prefix=/usr lib=lib64
make prefix=/usr lib=lib64 install

shadow
touch /usr/bin/passwd
configure --sysconf=/etc --with-group-name-max-length=32 --without-nscd

gcc
configure --prefix=/usr LD=ld --disable-multilib --disable-bootstrap --with-system-zlib --enable-languages=c,c++,lto --libdir=/usr/lib64
make

testing:
ulimit -s 32768
chown -Rv tester . 
su tester -c "PATH=$PATH make -k check"

make install
rm -rf /usr/lib64/gcc/$(gcc -dumpmachine)/10.2.0/include-fixed/bits/
chown -v -R root:root /usr/lib64/gcc/*linux-gnu/10.2.0/include{,-fixed}
ln -s ../usr/bin/cpp /lib
mkdir -p /usr/lib64/bfd-plugins
ln -s ../../libexec/gcc/$(gcc -dumpmachine)/10.2.0/liblto_plugin.so /usr/lib64/bfd-plugins/
TODO: test if the GDB autoload Python script needs moving as per guide.

pkg-config
configure --prefix=/osbt --with-internal-glib --disable-host-tool --with-pc-path=/usr/lib/pkgconfig
As components are built with libdir pointing to /usr/lib64, pkgconfig
directory ends up there without the ability to control where it ends up, add a
symlink to smooth things out.
ln -s ../lib64/pkgconfig /usr/lib/pkgconfig

ncurses
configure --prefix=/usr --mandir=/usr/share/man --with-shared --without-debug --without-normal --enable-pc-files --enable-widec --libdir=/usr/lib64 --with-pkg-config-libdir=/usr/lib64/pkgconfig
make
make install
for lib in form panel menu ; do
echo "INPUT(-l${lib}w)" > /usr/lib64/lib${lib}.so
ln -s ${lib}w.pc        /usr/lib64/pkgconfig/${lib}.pc
done
echo "INPUT(-lncursesw)" > /usr/lib64/libcursesw.so
ln -s libncurses.so      /usr/lib64/libcurses.so
rm /usr/lib64/libncurses++w.a

gettext
configure --prefix=/usr --disable-static --libdir=/usr/lib64

bison
configure --prefix=/osbt

grep
Point to bash for the benefit of test stage, otherwise tests fail.
configure --prefix=/usr --bindir=/bin SHELL=/bin/bash

bash
configure --prefix=/usr --without-bash-malloc --with-installed-readline --libdir=/usr/lib64

inetutils
configure --prefix=/usr --localstatedir=/var --disable-logger --disable-whois --disable-rcp --disable-rexec --disable-rlogin --disable-rsh --disable-servers --disable-ping --disable-ping6 --disable-ping

perl
export BUILD_ZLIB=False
export BUILD_BZIP2=0
sh Configure -des -Dprefix=/osbt -Dvendorprefix=/osbt -Dprivlib=/osbt/lib/perl5/5.32/core_perl -Darchlib=/osbt/lib/perl5/5.32/core_perl -Dsitelib=/osbt/lib/perl5/5.32/site_perl -Dsitearch=/osbt/lib/perl5/5.32/site_perl -Dvendorlib=/osbt/lib/perl5/5.32/vendor_perl -Dvendorarch=/osbt/lib/perl5/5.32/vendor_perl -Uinstallusrbinperl -Dman1dir=/osbt/share/man/man1 -Dman3dir=/osbt/share/man/man3 -Dpager="/usr/bin/less -isR" -Duseshrplib -Dusethreads
